<div class="sidebar">
  <div class="row d-flex justify-content-center">
    <%= link_to dashboard_path, class: "navbar-brand" do %>
      <%= image_tag "logo.png" %>
    <% end %>
  </div>

  <% if !bookings.empty? %>
    <h2 class= "mt-5 mb-0">Mon dernier cours</h2>
    <div class="row card-cours">
    <% last_booking = bookings.joins(:slot).where("slots.start < ?", DateTime.now()).order("slots.start").last %>
      <div class="d-flex ">
        <div class="col-3 mt-2">
          <%= cl_image_tag last_booking.slot.teacher.photo.key, class: "avatar-large"%>
        </div>
        <div class="col-9 mt-3">
          <h3 class="card-title mb-1"> Mon cours avec <%= last_booking.slot.teacher.first_name%></h3>
          <p class="card-title"> üìÖ <%= I18n.l(last_booking.slot.start, format: :date, locale: :fr).capitalize %></p>
        </div>
      </div>
      <div class="card-body d-flex flex-column">
        <div class="d-flex">
          <div class="jauge-card">
            <svg width="50" height="25" xmlns="http://www.w3.org/2000/svg">
              <path d="M 0 25 A 25 25, 0, 1, 1 50 25 Z" fill="lightgrey">
              </path>
              <path d="M 0 25 A 25 25, 0, 0, 1 <%= 25 - Math.cos(last_booking.respect)*25%> <%= 25 - Math.sin(last_booking.respect)*25%> L 25 25 Z" fill="<%=last_booking.respect_color%>">
              </path>
            </svg>
            <div class="curseur-card"style="background-image: url('<%= image_path 'curseur.png' %>'); transform: rotate(<%= ((last_booking.respect / (Math::PI / 5)) * 36 - 90 ) %>deg)">
            </div>
          </div>
          <h3 class="m-3 jauge-title mb-0" style="font-size: 12px;">APPR√âHENDER LA ROUTE</h3>
        </div>
        <div class="d-flex">
          <div class="jauge-card">
            <svg width="50" height="25" xmlns="http://www.w3.org/2000/svg">
            <path d="M 0 25 A 25 25, 0, 1, 1 50 25 Z" fill="lightgrey">
            </path>
            <path d="M 0 25 A 25 25, 0, 0, 1 <%= 25 - Math.cos(last_booking.share)*25%> <%= 25 - Math.sin(last_booking.share)*25%> L 25 25 Z" fill="<%=last_booking.share_color%>">
            </path>
            </svg>
            <div class="curseur-card"style="background-image: url('<%= image_path 'curseur.png' %>'); transform: rotate(<%= ((last_booking.share / (Math::PI / 5)) * 36 - 90 ) %>deg)">
            </div>
          </div>
          <h3 class="m-3 jauge-title mb-0" style="font-size: 12px;">PARTAGER LA ROUTE</h3>
        </div>
        <div class="d-flex">
          <div class="jauge-card">
            <svg width="50" height="25" xmlns="http://www.w3.org/2000/svg">
            <path d="M 0 25 A 25 25, 0, 1, 1 50 25 Z" fill="lightgrey">
            </path>
            <path d="M 0 25 A 25 25, 0, 0, 1 <%= 25 - Math.cos(last_booking.control)*25%> <%= 25 - Math.sin(last_booking.control)*25%> L 25 25 Z" fill="<%=last_booking.control_color%>">
            </path>
            </svg>
            <div class="curseur-card"style="background-image: url('<%= image_path 'curseur.png' %>'); transform: rotate(<%= ((last_booking.control / (Math::PI / 5)) * 36 - 90 ) %>deg)">
            </div>
          </div>
          <h3 class="m-3 jauge-title mb-0" style="font-size: 12px;">MAITRISER SON V√âHICULE</h3>
        </div>
      </div>

      <div>
        <% if last_booking.review_evaluation.nil? %>
          <%= link_to '#', class: "btn-outline btn-card-cardetour", id:"btn-blue" do%>
            EN ATTENTE D'√âVALUATION
          <% end %>
        <% else %>
          <%= link_to booking_path(last_booking), class: "btn-outline btn-card-cardetour btn" do%>
            VOIR MON EVALUATION
          <% end %>
        <% end %>
      </div>
    </div>


    <div class="d-flex justify-content-around align-item-center">
      <h2 class= "mb-0">Mes cours √† venir</h2>
      <div class="d-flex justify-content-between text-align-center">
      <%= link_to '+', new_booking_path, class: "btn-plus", style: 'font-size: 18px' %>
      </div>
    </div>

    <div class="row card-cours-f">
      <div class="card-scroll-futur">
      <% bookings_sorted = bookings.sort_by { |booking| booking.slot.start } %>
      <% bookings_s = bookings_sorted %>
      <% bookings_s.each do |booking| %>
        <% if booking.slot.start > DateTime.now()%>
          <div class="card card-booking">
            <div class="card-body">
              <div class= "d-flex">
                <h3 class="card-title"> üìÖ <%= I18n.l(booking.slot.start, format: :date_short, locale: :fr).capitalize %> </h3>
                <h3 class="card-title ml-2"> üïê <%= booking.slot.start.strftime("%H:%M")%></h3>
              </div>
              <p class="card-text"> üìç<%=booking.address%></p>
              <div class="mt-4">
                <a><%= link_to "MODIFIER", edit_booking_path(booking), class:"btn-outline btn-card-cardetour"%></a>
                <a><%= link_to "ANNULER", booking_path(booking), method: :delete, data: { confirm: "Are you sure?" }, class:"btn-outline btn-card-cardetour"%></a>
              </div>
            </div>
            <div class="card-avatar">
              <%= cl_image_tag booking.slot.teacher.photo.key, class: "avatar"%>
            </div>
          </div>
        <% end %>
      <% end %>
      </div>
    </div>
  <% end %>
</div>
